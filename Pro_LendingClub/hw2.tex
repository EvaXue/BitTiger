\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={HW2},
            pdfauthor={Eva},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{HW2}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{Eva}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{6/23/2018}


\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{## reference }
\NormalTok{##https://www.kaggle.com/farazrahman/lending-club-check-before-you-cheque/notebook}
\NormalTok{## https://www.kaggle.com/erykwalczak/initial-loan-book-analysis}
\NormalTok{##https://www.kaggle.com/dhanyajothimani/lending-loan-dataset-visualization}

\KeywordTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'dplyr'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:stats':
## 
##     filter, lag
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(parsedate)}
\KeywordTok{library}\NormalTok{(lubridate)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'lubridate'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:base':
## 
##     date
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(DescTools)}
\NormalTok{##question}
\NormalTok{##Think about if/how you would process old features and what new features to be generated.}
\NormalTok{##Build the best linear regression model to explain interest rate.}
\KeywordTok{rm}\NormalTok{(}\DataTypeTok{list=}\KeywordTok{ls}\NormalTok{())}
\KeywordTok{setwd}\NormalTok{(}\StringTok{"~/evagit/BitTiger/Pro_LendingClub"}\NormalTok{)}
\NormalTok{loan_df=}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"loan.csv"}\NormalTok{, }\DataTypeTok{stringsAsFactors =} \OtherTok{FALSE}\NormalTok{)}
\KeywordTok{glimpse}\NormalTok{(loan_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Observations: 887,379
## Variables: 74
## $ id                          <int> 1077501, 1077430, 1077175, 1076863...
## $ member_id                   <int> 1296599, 1314167, 1313524, 1277178...
## $ loan_amnt                   <dbl> 5000, 2500, 2400, 10000, 3000, 500...
## $ funded_amnt                 <dbl> 5000, 2500, 2400, 10000, 3000, 500...
## $ funded_amnt_inv             <dbl> 4975.00, 2500.00, 2400.00, 10000.0...
## $ term                        <chr> " 36 months", " 60 months", " 36 m...
## $ int_rate                    <dbl> 10.65, 15.27, 15.96, 13.49, 12.69,...
## $ installment                 <dbl> 162.87, 59.83, 84.33, 339.31, 67.7...
## $ grade                       <chr> "B", "C", "C", "C", "B", "A", "C",...
## $ sub_grade                   <chr> "B2", "C4", "C5", "C1", "B5", "A4"...
## $ emp_title                   <chr> "", "Ryder", "", "AIR RESOURCES BO...
## $ emp_length                  <chr> "10+ years", "< 1 year", "10+ year...
## $ home_ownership              <chr> "RENT", "RENT", "RENT", "RENT", "R...
## $ annual_inc                  <dbl> 24000.00, 30000.00, 12252.00, 4920...
## $ verification_status         <chr> "Verified", "Source Verified", "No...
## $ issue_d                     <chr> "Dec-2011", "Dec-2011", "Dec-2011"...
## $ loan_status                 <chr> "Fully Paid", "Charged Off", "Full...
## $ pymnt_plan                  <chr> "n", "n", "n", "n", "n", "n", "n",...
## $ url                         <chr> "https://www.lendingclub.com/brows...
## $ desc                        <chr> "  Borrower added on 12/22/11 > I ...
## $ purpose                     <chr> "credit_card", "car", "small_busin...
## $ title                       <chr> "Computer", "bike", "real estate b...
## $ zip_code                    <chr> "860xx", "309xx", "606xx", "917xx"...
## $ addr_state                  <chr> "AZ", "GA", "IL", "CA", "OR", "AZ"...
## $ dti                         <dbl> 27.65, 1.00, 8.72, 20.00, 17.94, 1...
## $ delinq_2yrs                 <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
## $ earliest_cr_line            <chr> "Jan-1985", "Apr-1999", "Nov-2001"...
## $ inq_last_6mths              <dbl> 1, 5, 2, 1, 0, 3, 1, 2, 2, 0, 2, 0...
## $ mths_since_last_delinq      <dbl> NA, NA, NA, 35, 38, NA, NA, NA, NA...
## $ mths_since_last_record      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ open_acc                    <dbl> 3, 3, 2, 10, 15, 9, 7, 4, 11, 2, 1...
## $ pub_rec                     <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
## $ revol_bal                   <dbl> 13648, 1687, 2956, 5598, 27783, 79...
## $ revol_util                  <dbl> 83.70, 9.40, 98.50, 21.00, 53.90, ...
## $ total_acc                   <dbl> 9, 4, 10, 37, 38, 12, 11, 4, 13, 3...
## $ initial_list_status         <chr> "f", "f", "f", "f", "f", "f", "f",...
## $ out_prncp                   <dbl> 0.00, 0.00, 0.00, 0.00, 766.90, 0....
## $ out_prncp_inv               <dbl> 0.00, 0.00, 0.00, 0.00, 766.90, 0....
## $ total_pymnt                 <dbl> 5861.071, 1008.710, 3003.654, 1222...
## $ total_pymnt_inv             <dbl> 5831.78, 1008.71, 3003.65, 12226.3...
## $ total_rec_prncp             <dbl> 5000.00, 456.46, 2400.00, 10000.00...
## $ total_rec_int               <dbl> 861.07, 435.17, 603.65, 2209.33, 1...
## $ total_rec_late_fee          <dbl> 0.00, 0.00, 0.00, 16.97, 0.00, 0.0...
## $ recoveries                  <dbl> 0.00, 117.08, 0.00, 0.00, 0.00, 0....
## $ collection_recovery_fee     <dbl> 0.0000, 1.1100, 0.0000, 0.0000, 0....
## $ last_pymnt_d                <chr> "Jan-2015", "Apr-2013", "Jun-2014"...
## $ last_pymnt_amnt             <dbl> 171.62, 119.66, 649.91, 357.48, 67...
## $ next_pymnt_d                <chr> "", "", "", "", "Feb-2016", "", "F...
## $ last_credit_pull_d          <chr> "Jan-2016", "Sep-2013", "Jan-2016"...
## $ collections_12_mths_ex_med  <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
## $ mths_since_last_major_derog <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ policy_code                 <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1...
## $ application_type            <chr> "INDIVIDUAL", "INDIVIDUAL", "INDIV...
## $ annual_inc_joint            <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ dti_joint                   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ verification_status_joint   <chr> "", "", "", "", "", "", "", "", ""...
## $ acc_now_delinq              <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
## $ tot_coll_amt                <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ tot_cur_bal                 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ open_acc_6m                 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ open_il_6m                  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ open_il_12m                 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ open_il_24m                 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ mths_since_rcnt_il          <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ total_bal_il                <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ il_util                     <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ open_rv_12m                 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ open_rv_24m                 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ max_bal_bc                  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ all_util                    <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ total_rev_hi_lim            <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ inq_fi                      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ total_cu_tl                 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ inq_last_12m                <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(}\KeywordTok{duplicated}\NormalTok{(loan_df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{## check if id and member_id is unique => 887379 }
\KeywordTok{length}\NormalTok{(}\KeywordTok{unique}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{id))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 887379
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{length}\NormalTok{(}\KeywordTok{unique}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{member_id))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 887379
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{##select features with less than 20% missing value}
\NormalTok{num.NA =}\StringTok{ }\KeywordTok{sort}\NormalTok{(}\KeywordTok{sapply}\NormalTok{(loan_df, }\ControlFlowTok{function}\NormalTok{(x)\{}\KeywordTok{sum}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(x))\}), }\DataTypeTok{decreasing=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{remain.col =}\StringTok{ }\KeywordTok{names}\NormalTok{(num.NA)[}\KeywordTok{which}\NormalTok{(num.NA}\OperatorTok{/}\KeywordTok{nrow}\NormalTok{(loan_df)}\OperatorTok{<=}\FloatTok{0.8}\NormalTok{)]}
\NormalTok{loan_df=loan_df[,remain.col]}

\NormalTok{## check the columns with less than 4 unique values}

\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\StringTok{ }\KeywordTok{length}\NormalTok{(loan_df))\{}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{dim}\NormalTok{(}\KeywordTok{unique}\NormalTok{(loan_df[i]))[}\DecValTok{1}\NormalTok{]}\OperatorTok{<}\DecValTok{4}\NormalTok{)\{}
    \KeywordTok{print}\NormalTok{ (}\KeywordTok{names}\NormalTok{(loan_df[i]))}
    \KeywordTok{print}\NormalTok{ (}\KeywordTok{table}\NormalTok{(loan_df[i]))}
\NormalTok{  \}}
  
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "term"
## 
##  36 months  60 months 
##     621125     266254 
## [1] "verification_status"
## 
##    Not Verified Source Verified        Verified 
##          266750          329558          291071 
## [1] "pymnt_plan"
## 
##      n      y 
## 887369     10 
## [1] "initial_list_status"
## 
##      f      w 
## 456848 430531 
## [1] "policy_code"
## 
##      1 
## 887379 
## [1] "application_type"
## 
## INDIVIDUAL      JOINT 
##     886868        511
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{##following 3 features need to be concerned.}
\NormalTok{##exclude "pymnt_plan" and "policy_code" from the dataset}
\NormalTok{##we may keep the "application_type" for further discussion}

\CommentTok{# "pymnt_plan"}
\CommentTok{# }
\CommentTok{#      n      y }
\CommentTok{# 887369     10 }

\CommentTok{# [1] "policy_code"}
\CommentTok{# }
\CommentTok{#      1 }
\CommentTok{# 887379 }

\CommentTok{# "application_type"}
\CommentTok{# }
\CommentTok{# INDIVIDUAL      JOINT }
\CommentTok{#     886868        511 }


\NormalTok{##check all categorical variables}
\NormalTok{loan_df.type=}\KeywordTok{sapply}\NormalTok{(loan_df, class)}
\NormalTok{loan_df.categorical=loan_df[,}\KeywordTok{names}\NormalTok{(loan_df.type[}\KeywordTok{which}\NormalTok{(loan_df.type}\OperatorTok{==}\StringTok{"character"}\NormalTok{)])]}
\KeywordTok{str}\NormalTok{(loan_df.categorical)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    887379 obs. of  23 variables:
##  $ term                     : chr  " 36 months" " 60 months" " 36 months" " 36 months" ...
##  $ grade                    : chr  "B" "C" "C" "C" ...
##  $ sub_grade                : chr  "B2" "C4" "C5" "C1" ...
##  $ emp_title                : chr  "" "Ryder" "" "AIR RESOURCES BOARD" ...
##  $ emp_length               : chr  "10+ years" "< 1 year" "10+ years" "10+ years" ...
##  $ home_ownership           : chr  "RENT" "RENT" "RENT" "RENT" ...
##  $ verification_status      : chr  "Verified" "Source Verified" "Not Verified" "Source Verified" ...
##  $ issue_d                  : chr  "Dec-2011" "Dec-2011" "Dec-2011" "Dec-2011" ...
##  $ loan_status              : chr  "Fully Paid" "Charged Off" "Fully Paid" "Fully Paid" ...
##  $ pymnt_plan               : chr  "n" "n" "n" "n" ...
##  $ url                      : chr  "https://www.lendingclub.com/browse/loanDetail.action?loan_id=1077501" "https://www.lendingclub.com/browse/loanDetail.action?loan_id=1077430" "https://www.lendingclub.com/browse/loanDetail.action?loan_id=1077175" "https://www.lendingclub.com/browse/loanDetail.action?loan_id=1076863" ...
##  $ desc                     : chr  "  Borrower added on 12/22/11 > I need to upgrade my business technologies.<br>" "  Borrower added on 12/22/11 > I plan to use this money to finance the motorcycle i am looking at. I plan to ha"| __truncated__ "" "  Borrower added on 12/21/11 > to pay for property tax (borrow from friend, need to pay back) & central A/C nee"| __truncated__ ...
##  $ purpose                  : chr  "credit_card" "car" "small_business" "other" ...
##  $ title                    : chr  "Computer" "bike" "real estate business" "personel" ...
##  $ zip_code                 : chr  "860xx" "309xx" "606xx" "917xx" ...
##  $ addr_state               : chr  "AZ" "GA" "IL" "CA" ...
##  $ earliest_cr_line         : chr  "Jan-1985" "Apr-1999" "Nov-2001" "Feb-1996" ...
##  $ initial_list_status      : chr  "f" "f" "f" "f" ...
##  $ last_pymnt_d             : chr  "Jan-2015" "Apr-2013" "Jun-2014" "Jan-2015" ...
##  $ next_pymnt_d             : chr  "" "" "" "" ...
##  $ last_credit_pull_d       : chr  "Jan-2016" "Sep-2013" "Jan-2016" "Jan-2015" ...
##  $ application_type         : chr  "INDIVIDUAL" "INDIVIDUAL" "INDIVIDUAL" "INDIVIDUAL" ...
##  $ verification_status_joint: chr  "" "" "" "" ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{##check unique values for each categorical variable}
\KeywordTok{sapply}\NormalTok{(loan_df.categorical, }\ControlFlowTok{function}\NormalTok{(x)\{ }\KeywordTok{length}\NormalTok{(}\KeywordTok{unique}\NormalTok{(x))\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                      term                     grade 
##                         2                         7 
##                 sub_grade                 emp_title 
##                        35                    299273 
##                emp_length            home_ownership 
##                        12                         6 
##       verification_status                   issue_d 
##                         3                       103 
##               loan_status                pymnt_plan 
##                        10                         2 
##                       url                      desc 
##                    887379                    124471 
##                   purpose                     title 
##                        14                     63146 
##                  zip_code                addr_state 
##                       935                        51 
##          earliest_cr_line       initial_list_status 
##                       698                         2 
##              last_pymnt_d              next_pymnt_d 
##                        99                       101 
##        last_credit_pull_d          application_type 
##                       104                         2 
## verification_status_joint 
##                         4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{##delete the categorical values with too many unique values}


\NormalTok{## after checking the features, deleting : }
\CommentTok{#url,}
\CommentTok{#desc => it's similar to purpose}
\CommentTok{# loan_df=loan_df[,-which(colnames(loan_df)%in%c("pymnt_plan","policy_code",'id', 'member_id', 'url','desc', 'title','emp_title','zip_code'))]}

\NormalTok{loan_df <-}\StringTok{ }\KeywordTok{within}\NormalTok{(loan_df, }\KeywordTok{rm}\NormalTok{(}\StringTok{"pymnt_plan"}\NormalTok{,}\StringTok{"policy_code"}\NormalTok{,}\StringTok{'id'}\NormalTok{, }\StringTok{'member_id'}\NormalTok{, }\StringTok{'url'}\NormalTok{,}\StringTok{'desc'}\NormalTok{, }\StringTok{'title'}\NormalTok{,}\StringTok{'emp_title'}\NormalTok{,}\StringTok{'zip_code'}\NormalTok{))}

\NormalTok{##compute meaningful time features}
\NormalTok{##convert date string to date, transform issue date by year}

\NormalTok{loan_df}\OperatorTok{$}\NormalTok{issue_year =}\StringTok{ }\KeywordTok{sapply}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{issue_d, }\ControlFlowTok{function}\NormalTok{(x)\{}\KeywordTok{substr}\NormalTok{(x, }\KeywordTok{nchar}\NormalTok{(x)}\OperatorTok{-}\DecValTok{3}\NormalTok{,}\KeywordTok{nchar}\NormalTok{(x) )\})}
\KeywordTok{plot}\NormalTok{(}\KeywordTok{table}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{issue_year), }\DataTypeTok{main=}\StringTok{"Loan Issued Over the Year"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Amount"}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{"Year"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{hw2_files/figure-latex/cleaning-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{##too many levels}
\NormalTok{##we can group the states into region by economic level / geolocation / average interest rate}
\NormalTok{##group the states by region}
\KeywordTok{unique}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{addr_state)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "AZ" "GA" "IL" "CA" "OR" "NC" "TX" "VA" "MO" "CT" "UT" "FL" "NY" "PA"
## [15] "MN" "NJ" "KY" "OH" "SC" "RI" "LA" "MA" "WA" "WI" "AL" "CO" "KS" "NV"
## [29] "AK" "MD" "WV" "VT" "MI" "DC" "SD" "NH" "AR" "NM" "MT" "HI" "WY" "OK"
## [43] "DE" "MS" "TN" "IA" "NE" "ID" "IN" "ME" "ND"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{west =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'CA'}\NormalTok{, }\StringTok{'OR'}\NormalTok{, }\StringTok{'UT'}\NormalTok{,}\StringTok{'WA'}\NormalTok{, }\StringTok{'CO'}\NormalTok{, }\StringTok{'NV'}\NormalTok{, }\StringTok{'AK'}\NormalTok{, }\StringTok{'MT'}\NormalTok{, }\StringTok{'HI'}\NormalTok{, }\StringTok{'WY'}\NormalTok{, }\StringTok{'ID'}\NormalTok{)}
\NormalTok{south_west =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'AZ'}\NormalTok{, }\StringTok{'TX'}\NormalTok{, }\StringTok{'NM'}\NormalTok{, }\StringTok{'OK'}\NormalTok{)}
\NormalTok{south_east =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'GA'}\NormalTok{, }\StringTok{'NC'}\NormalTok{, }\StringTok{'VA'}\NormalTok{, }\StringTok{'FL'}\NormalTok{, }\StringTok{'KY'}\NormalTok{, }\StringTok{'SC'}\NormalTok{, }\StringTok{'LA'}\NormalTok{, }\StringTok{'AL'}\NormalTok{, }\StringTok{'WV'}\NormalTok{, }\StringTok{'DC'}\NormalTok{, }\StringTok{'AR'}\NormalTok{, }\StringTok{'DE'}\NormalTok{, }\StringTok{'MS'}\NormalTok{, }\StringTok{'TN'}\NormalTok{ )}
\NormalTok{mid_west =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'IL'}\NormalTok{, }\StringTok{'MO'}\NormalTok{, }\StringTok{'MN'}\NormalTok{, }\StringTok{'OH'}\NormalTok{, }\StringTok{'WI'}\NormalTok{, }\StringTok{'KS'}\NormalTok{, }\StringTok{'MI'}\NormalTok{, }\StringTok{'SD'}\NormalTok{, }\StringTok{'IA'}\NormalTok{, }\StringTok{'NE'}\NormalTok{, }\StringTok{'IN'}\NormalTok{, }\StringTok{'ND'}\NormalTok{)}
\NormalTok{north_east =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'CT'}\NormalTok{, }\StringTok{'NY'}\NormalTok{, }\StringTok{'PA'}\NormalTok{, }\StringTok{'NJ'}\NormalTok{, }\StringTok{'RI'}\NormalTok{,}\StringTok{'MA'}\NormalTok{, }\StringTok{'MD'}\NormalTok{, }\StringTok{'VT'}\NormalTok{, }\StringTok{'NH'}\NormalTok{, }\StringTok{'ME'}\NormalTok{)}

\NormalTok{state_to_Reagion =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(s)\{}
  \ControlFlowTok{if}\NormalTok{ (s }\OperatorTok{%in%}\StringTok{ }\NormalTok{west)\{}
    \KeywordTok{return}\NormalTok{ (}\StringTok{"WEST"}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (s }\OperatorTok{%in%}\StringTok{ }\NormalTok{south_west)\{}
    \KeywordTok{return}\NormalTok{ (}\StringTok{"SOUTH_WEST"}\NormalTok{)}
\NormalTok{    \}}
  \ControlFlowTok{if}\NormalTok{ (s }\OperatorTok{%in%}\StringTok{ }\NormalTok{south_east)\{}
    \KeywordTok{return}\NormalTok{ (}\StringTok{"SOUTH_EAST"}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (s }\OperatorTok{%in%}\StringTok{ }\NormalTok{mid_west)\{}
    \KeywordTok{return}\NormalTok{ (}\StringTok{"MID_WEST"}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (s }\OperatorTok{%in%}\StringTok{ }\NormalTok{north_east)\{}
    \KeywordTok{return}\NormalTok{ (}\StringTok{"NORTH_EAST"}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{else}\NormalTok{\{}
    \KeywordTok{return}\NormalTok{ (}\StringTok{"Missing_Region"}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{\}}

\NormalTok{loan_df}\OperatorTok{$}\NormalTok{Region =}\StringTok{ }\KeywordTok{sapply}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{addr_state, state_to_Reagion )}

\KeywordTok{plot}\NormalTok{(}\KeywordTok{table}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{Region, loan_df}\OperatorTok{$}\NormalTok{issue_year), }\DataTypeTok{main=}\StringTok{"Loan Issued by Region over the Years"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{hw2_files/figure-latex/cleaning-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{##remove addr_state}
\NormalTok{loan_df=}\KeywordTok{within}\NormalTok{(loan_df, }\KeywordTok{rm}\NormalTok{(}\StringTok{'addr_state'}\NormalTok{))}

\NormalTok{## check the employment length}
\KeywordTok{table}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{emp_length)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  < 1 year    1 year 10+ years   2 years   3 years   4 years   5 years 
##     70605     57095    291569     78870     70026     52529     55704 
##   6 years   7 years   8 years   9 years       n/a 
##     42950     44594     43955     34657     44825
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{## convert employment length into numeric value}
\NormalTok{emp_length_c_to_n=}\ControlFlowTok{function}\NormalTok{(x)\{}
  \ControlFlowTok{if}\NormalTok{(x}\OperatorTok{==}\StringTok{"< 1 year"}\NormalTok{)\{}
    \KeywordTok{return}\NormalTok{(}\FloatTok{0.5}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(x}\OperatorTok{==}\StringTok{"1 year"}\NormalTok{)\{}
    \KeywordTok{return}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(x}\OperatorTok{==}\StringTok{"2 years"}\NormalTok{)\{}
    \KeywordTok{return}\NormalTok{(}\DecValTok{2}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(x}\OperatorTok{==}\StringTok{"3 years"}\NormalTok{)\{}
    \KeywordTok{return}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(x}\OperatorTok{==}\StringTok{"4 years"}\NormalTok{)\{}
    \KeywordTok{return}\NormalTok{(}\DecValTok{4}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(x}\OperatorTok{==}\StringTok{"5 years"}\NormalTok{)\{}
    \KeywordTok{return}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(x}\OperatorTok{==}\StringTok{"6 years"}\NormalTok{)\{}
    \KeywordTok{return}\NormalTok{(}\DecValTok{6}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(x}\OperatorTok{==}\StringTok{"7 years"}\NormalTok{)\{}
    \KeywordTok{return}\NormalTok{(}\DecValTok{7}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(x}\OperatorTok{==}\StringTok{"8 years"}\NormalTok{)\{}
    \KeywordTok{return}\NormalTok{(}\DecValTok{8}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(x}\OperatorTok{==}\StringTok{"9 years"}\NormalTok{)\{}
    \KeywordTok{return}\NormalTok{(}\DecValTok{9}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(x}\OperatorTok{==}\StringTok{"10+ years"}\NormalTok{)\{}
    \KeywordTok{return}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{else}\NormalTok{\{}
    \KeywordTok{return}\NormalTok{(}\DecValTok{0}\NormalTok{)}
\NormalTok{  \}}
    
\NormalTok{\}}

\NormalTok{loan_df}\OperatorTok{$}\NormalTok{Employment_Length =}\StringTok{ }\KeywordTok{sapply}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{emp_length, emp_length_c_to_n)}
\KeywordTok{summary}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{Employment_Length)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.000   2.000   6.000   5.745  10.000  10.000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{##delete some categorical variables}
\NormalTok{loan_df=loan_df[,}\OperatorTok{-}\KeywordTok{which}\NormalTok{(}\KeywordTok{colnames}\NormalTok{(loan_df)}\OperatorTok{%in%}\KeywordTok{c}\NormalTok{(}\StringTok{"emp_length"}\NormalTok{))]}

\NormalTok{##delete the variables which will not be available at the time of deciding the intereste rate}
\CommentTok{#remove the potential related responsive variable except "int_rate"}
\NormalTok{loan_df=}\KeywordTok{within}\NormalTok{(loan_df, }\KeywordTok{rm}\NormalTok{(}\StringTok{"funded_amnt"}\NormalTok{, }\StringTok{"funded_amnt_inv"}\NormalTok{,  }\StringTok{"out_prncp"}\NormalTok{, }\StringTok{"out_prncp_inv"}\NormalTok{, }\StringTok{"total_pymnt"}\NormalTok{, }\StringTok{"total_pymnt_inv"}\NormalTok{, }\StringTok{"total_rec_int"}\NormalTok{, }\StringTok{"total_rec_late_fee"}\NormalTok{, }\StringTok{"total_rec_prncp"}\NormalTok{, }\StringTok{'grade'}\NormalTok{,}\StringTok{"sub_grade"}\NormalTok{,}\StringTok{"loan_status"}\NormalTok{,}\StringTok{"last_credit_pull_d"}\NormalTok{,}\StringTok{"next_pymnt_d"}\NormalTok{, }\StringTok{"last_pymnt_amnt"}\NormalTok{, }\StringTok{"next_pymnt_d"}\NormalTok{, }\StringTok{"last_pymnt_d"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in rm("funded_amnt", "funded_amnt_inv", "out_prncp",
## "out_prncp_inv", : object 'next_pymnt_d' not found
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{##check the reminding categorical variables and convert them into factor}
\NormalTok{loan_df.type=}\KeywordTok{sapply}\NormalTok{(loan_df, class)}
\NormalTok{loan_df.categorical=loan_df[,}\KeywordTok{names}\NormalTok{(loan_df.type[}\KeywordTok{which}\NormalTok{(loan_df.type}\OperatorTok{==}\StringTok{"character"}\NormalTok{)])]}
\KeywordTok{str}\NormalTok{(loan_df.categorical)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    887379 obs. of  11 variables:
##  $ term                     : chr  " 36 months" " 60 months" " 36 months" " 36 months" ...
##  $ home_ownership           : chr  "RENT" "RENT" "RENT" "RENT" ...
##  $ verification_status      : chr  "Verified" "Source Verified" "Not Verified" "Source Verified" ...
##  $ issue_d                  : chr  "Dec-2011" "Dec-2011" "Dec-2011" "Dec-2011" ...
##  $ purpose                  : chr  "credit_card" "car" "small_business" "other" ...
##  $ earliest_cr_line         : chr  "Jan-1985" "Apr-1999" "Nov-2001" "Feb-1996" ...
##  $ initial_list_status      : chr  "f" "f" "f" "f" ...
##  $ application_type         : chr  "INDIVIDUAL" "INDIVIDUAL" "INDIVIDUAL" "INDIVIDUAL" ...
##  $ verification_status_joint: chr  "" "" "" "" ...
##  $ issue_year               : chr  "2011" "2011" "2011" "2011" ...
##  $ Region                   : chr  "SOUTH_WEST" "SOUTH_EAST" "MID_WEST" "WEST" ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{loan_df}\OperatorTok{$}\NormalTok{term=}\KeywordTok{as.factor}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{term)}
\NormalTok{loan_df}\OperatorTok{$}\NormalTok{home_ownership=}\KeywordTok{as.factor}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{home_ownership)}
\NormalTok{loan_df}\OperatorTok{$}\NormalTok{verification_status=}\KeywordTok{as.factor}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{verification_status)}
\NormalTok{loan_df}\OperatorTok{$}\NormalTok{purpose=}\KeywordTok{as.factor}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{purpose)}
\NormalTok{loan_df}\OperatorTok{$}\NormalTok{initial_list_status=}\KeywordTok{as.factor}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{initial_list_status)}
\NormalTok{loan_df}\OperatorTok{$}\NormalTok{application_type=}\KeywordTok{as.factor}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{application_type)}
\NormalTok{loan_df}\OperatorTok{$}\NormalTok{verification_status_joint=}\KeywordTok{as.factor}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{verification_status_joint)}
\NormalTok{loan_df}\OperatorTok{$}\NormalTok{Region=}\KeywordTok{as.factor}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{Region)}
\NormalTok{loan_df}\OperatorTok{$}\NormalTok{issue_year=}\KeywordTok{as.factor}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{issue_year)}
\NormalTok{loan_df}\OperatorTok{$}\NormalTok{issue_d <-}\StringTok{ }\KeywordTok{dmy}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"01-"}\NormalTok{,loan_df}\OperatorTok{$}\NormalTok{issue_d))}
\NormalTok{loan_df}\OperatorTok{$}\NormalTok{earliest_cr_line <-}\StringTok{ }\KeywordTok{dmy}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"01-"}\NormalTok{,loan_df}\OperatorTok{$}\NormalTok{earliest_cr_line))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: 29 failed to parse.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{loan_df}\OperatorTok{$}\NormalTok{earliest_cr_line_year =}\KeywordTok{as.factor}\NormalTok{(}\KeywordTok{substring}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{earliest_cr_line, }\DecValTok{1}\NormalTok{,}\DecValTok{4}\NormalTok{))}
\KeywordTok{glimpse}\NormalTok{(loan_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Observations: 887,379
## Variables: 34
## $ mths_since_last_major_derog <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ mths_since_last_delinq      <dbl> NA, NA, NA, 35, 38, NA, NA, NA, NA...
## $ tot_coll_amt                <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ tot_cur_bal                 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ total_rev_hi_lim            <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ revol_util                  <dbl> 83.70, 9.40, 98.50, 21.00, 53.90, ...
## $ collections_12_mths_ex_med  <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
## $ delinq_2yrs                 <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
## $ inq_last_6mths              <dbl> 1, 5, 2, 1, 0, 3, 1, 2, 2, 0, 2, 0...
## $ open_acc                    <dbl> 3, 3, 2, 10, 15, 9, 7, 4, 11, 2, 1...
## $ pub_rec                     <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
## $ total_acc                   <dbl> 9, 4, 10, 37, 38, 12, 11, 4, 13, 3...
## $ acc_now_delinq              <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
## $ annual_inc                  <dbl> 24000.00, 30000.00, 12252.00, 4920...
## $ loan_amnt                   <dbl> 5000, 2500, 2400, 10000, 3000, 500...
## $ term                        <fct>  36 months,  60 months,  36 months...
## $ int_rate                    <dbl> 10.65, 15.27, 15.96, 13.49, 12.69,...
## $ installment                 <dbl> 162.87, 59.83, 84.33, 339.31, 67.7...
## $ home_ownership              <fct> RENT, RENT, RENT, RENT, RENT, RENT...
## $ verification_status         <fct> Verified, Source Verified, Not Ver...
## $ issue_d                     <date> 2011-12-01, 2011-12-01, 2011-12-0...
## $ purpose                     <fct> credit_card, car, small_business, ...
## $ dti                         <dbl> 27.65, 1.00, 8.72, 20.00, 17.94, 1...
## $ earliest_cr_line            <date> 1985-01-01, 1999-04-01, 2001-11-0...
## $ revol_bal                   <dbl> 13648, 1687, 2956, 5598, 27783, 79...
## $ initial_list_status         <fct> f, f, f, f, f, f, f, f, f, f, f, f...
## $ recoveries                  <dbl> 0.00, 117.08, 0.00, 0.00, 0.00, 0....
## $ collection_recovery_fee     <dbl> 0.0000, 1.1100, 0.0000, 0.0000, 0....
## $ application_type            <fct> INDIVIDUAL, INDIVIDUAL, INDIVIDUAL...
## $ verification_status_joint   <fct> , , , , , , , , , , , , , , , , , ...
## $ issue_year                  <fct> 2011, 2011, 2011, 2011, 2011, 2011...
## $ Region                      <fct> SOUTH_WEST, SOUTH_EAST, MID_WEST, ...
## $ Employment_Length           <dbl> 10.0, 0.5, 10.0, 10.0, 1.0, 3.0, 8...
## $ earliest_cr_line_year       <fct> 1985, 1999, 2001, 1996, 1996, 2004...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{Desc}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{purpose,  }\DataTypeTok{main =} \StringTok{"Loan purposes"}\NormalTok{, }\DataTypeTok{plotit =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## ------------------------------------------------------------------------- 
## Loan purposes
## 
##    length       n     NAs  unique  levels   dupes
##   887'379 887'379       0      14      14       y
##            100.0%    0.0%                        
## 
##                  level     freq   perc  cumfreq  cumperc
## 1   debt_consolidation  524'215  59.1%  524'215    59.1%
## 2          credit_card  206'182  23.2%  730'397    82.3%
## 3     home_improvement   51'829   5.8%  782'226    88.2%
## 4                other   42'894   4.8%  825'120    93.0%
## 5       major_purchase   17'277   1.9%  842'397    94.9%
## 6       small_business   10'377   1.2%  852'774    96.1%
## 7                  car    8'863   1.0%  861'637    97.1%
## 8              medical    8'540   1.0%  870'177    98.1%
## 9               moving    5'414   0.6%  875'591    98.7%
## 10            vacation    4'736   0.5%  880'327    99.2%
## 11               house    3'707   0.4%  884'034    99.6%
## 12             wedding    2'347   0.3%  886'381    99.9%
## ... etc.
##  [list output truncated]
\end{verbatim}

\includegraphics{hw2_files/figure-latex/cleaning-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{Desc}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{loan_amnt,  }\DataTypeTok{main =} \StringTok{"Loan Amount"}\NormalTok{, }\DataTypeTok{plotit =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## ------------------------------------------------------------------------- 
## Loan Amount
## 
##      length         n       NAs     unique         0s       mean
##     887'379   887'379         0      1'372          0  14'755.26
##                100.0%      0.0%                  0.0%           
##                                                                 
##         .05       .10       .25     median        .75        .90
##    3'600.00  5'000.00  8'000.00  13'000.00  20'000.00  28'000.00
##                                                                 
##       range        sd     vcoef        mad        IQR       skew
##   34'500.00  8'435.46      0.57   8'599.08  12'000.00       0.68
##                                                                 
##      meanCI
##   14'737.71
##   14'772.82
##            
##         .95
##   32'000.00
##            
##        kurt
##       -0.26
##            
## lowest : 500.0 (11), 550.0, 600.0 (6), 700.0 (3), 725.0
## highest: 34'900.0 (14), 34'925.0 (9), 34'950.0 (18), 34'975.0 (31), 35'000.0 (36'368)
\end{verbatim}

\includegraphics{hw2_files/figure-latex/cleaning-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{Desc}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{int_rate,  }\DataTypeTok{main =} \StringTok{"Interest Rate"}\NormalTok{, }\DataTypeTok{plotit =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## ------------------------------------------------------------------------- 
## Interest Rate
## 
##    length        n    NAs  unique     0s   mean  meanCI
##   887'379  887'379      0     542      0  13.25   13.24
##             100.0%   0.0%           0.0%          13.26
##                                                        
##       .05      .10    .25  median    .75    .90     .95
##      6.62     7.69   9.99   12.99  16.20  18.99   20.99
##                                                        
##     range       sd  vcoef     mad    IQR   skew    kurt
##     23.67     4.38   0.33    4.45   6.21   0.43   -0.16
##                                                        
## lowest : 5.32 (9'651), 5.42 (573), 5.79 (410), 5.93 (1'812), 5.99 (347)
## highest: 27.49 (7), 27.88 (222), 27.99 (5), 28.49 (139), 28.99 (112)
\end{verbatim}

\includegraphics{hw2_files/figure-latex/cleaning-5.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{##check the missing value in each column}
\KeywordTok{length}\NormalTok{(loan_df[,}\KeywordTok{which}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(loan_df}\OperatorTok{$}\NormalTok{int_rate))])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{##impute the misssing value with medium for all numeric variables}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \KeywordTok{colnames}\NormalTok{(loan_df) )\{}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{class}\NormalTok{(loan_df[,i])}\OperatorTok{==}\StringTok{"numeric"}\NormalTok{)\{}
\NormalTok{    loan_df[}\KeywordTok{is.na}\NormalTok{(loan_df[,i]),i] =}\StringTok{ }\KeywordTok{median}\NormalTok{(loan_df[,i], }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{)}
    \KeywordTok{print}\NormalTok{ (i)}
    \KeywordTok{print}\NormalTok{(}\KeywordTok{length}\NormalTok{(loan_df[,}\KeywordTok{which}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(loan_df[,i]))]))}
\NormalTok{  \}}

\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "mths_since_last_major_derog"
## [1] 0
## [1] "mths_since_last_delinq"
## [1] 0
## [1] "tot_coll_amt"
## [1] 0
## [1] "tot_cur_bal"
## [1] 0
## [1] "total_rev_hi_lim"
## [1] 0
## [1] "revol_util"
## [1] 0
## [1] "collections_12_mths_ex_med"
## [1] 0
## [1] "delinq_2yrs"
## [1] 0
## [1] "inq_last_6mths"
## [1] 0
## [1] "open_acc"
## [1] 0
## [1] "pub_rec"
## [1] 0
## [1] "total_acc"
## [1] 0
## [1] "acc_now_delinq"
## [1] 0
## [1] "annual_inc"
## [1] 0
## [1] "loan_amnt"
## [1] 0
## [1] "int_rate"
## [1] 0
## [1] "installment"
## [1] 0
## [1] "dti"
## [1] 0
## [1] "revol_bal"
## [1] 0
## [1] "recoveries"
## [1] 0
## [1] "collection_recovery_fee"
## [1] 0
## [1] "Employment_Length"
## [1] 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(loan_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  mths_since_last_major_derog mths_since_last_delinq  tot_coll_amt    
##  Min.   :  0.00              Min.   :  0.0          Min.   :      0  
##  1st Qu.: 44.00              1st Qu.: 31.0          1st Qu.:      0  
##  Median : 44.00              Median : 31.0          Median :      0  
##  Mean   : 44.03              Mean   : 32.5          Mean   :    208  
##  3rd Qu.: 44.00              3rd Qu.: 31.0          3rd Qu.:      0  
##  Max.   :188.00              Max.   :188.0          Max.   :9152545  
##                                                                      
##   tot_cur_bal      total_rev_hi_lim    revol_util    
##  Min.   :      0   Min.   :      0   Min.   :  0.00  
##  1st Qu.:  32246   1st Qu.:  14700   1st Qu.: 37.70  
##  Median :  80559   Median :  23700   Median : 56.00  
##  Mean   : 134794   Mean   :  31406   Mean   : 55.07  
##  3rd Qu.: 195794   3rd Qu.:  37800   3rd Qu.: 73.60  
##  Max.   :8000078   Max.   :9999999   Max.   :892.30  
##                                                      
##  collections_12_mths_ex_med  delinq_2yrs      inq_last_6mths   
##  Min.   : 0.00000           Min.   : 0.0000   Min.   : 0.0000  
##  1st Qu.: 0.00000           1st Qu.: 0.0000   1st Qu.: 0.0000  
##  Median : 0.00000           Median : 0.0000   Median : 0.0000  
##  Mean   : 0.01438           Mean   : 0.3144   Mean   : 0.6946  
##  3rd Qu.: 0.00000           3rd Qu.: 0.0000   3rd Qu.: 1.0000  
##  Max.   :20.00000           Max.   :39.0000   Max.   :33.0000  
##                                                                
##     open_acc        pub_rec          total_acc      acc_now_delinq     
##  Min.   : 0.00   Min.   : 0.0000   Min.   :  1.00   Min.   : 0.000000  
##  1st Qu.: 8.00   1st Qu.: 0.0000   1st Qu.: 17.00   1st Qu.: 0.000000  
##  Median :11.00   Median : 0.0000   Median : 24.00   Median : 0.000000  
##  Mean   :11.55   Mean   : 0.1953   Mean   : 25.27   Mean   : 0.004991  
##  3rd Qu.:14.00   3rd Qu.: 0.0000   3rd Qu.: 32.00   3rd Qu.: 0.000000  
##  Max.   :90.00   Max.   :86.0000   Max.   :169.00   Max.   :14.000000  
##                                                                        
##    annual_inc        loan_amnt             term           int_rate    
##  Min.   :      0   Min.   :  500    36 months:621125   Min.   : 5.32  
##  1st Qu.:  45000   1st Qu.: 8000    60 months:266254   1st Qu.: 9.99  
##  Median :  65000   Median :13000                       Median :12.99  
##  Mean   :  75028   Mean   :14755                       Mean   :13.25  
##  3rd Qu.:  90000   3rd Qu.:20000                       3rd Qu.:16.20  
##  Max.   :9500000   Max.   :35000                       Max.   :28.99  
##                                                                       
##   installment       home_ownership        verification_status
##  Min.   :  15.67   ANY     :     3   Not Verified   :266750  
##  1st Qu.: 260.70   MORTGAGE:443557   Source Verified:329558  
##  Median : 382.55   NONE    :    50   Verified       :291071  
##  Mean   : 436.72   OTHER   :   182                           
##  3rd Qu.: 572.60   OWN     : 87470                           
##  Max.   :1445.46   RENT    :356117                           
##                                                              
##     issue_d                         purpose            dti         
##  Min.   :2007-06-01   debt_consolidation:524215   Min.   :   0.00  
##  1st Qu.:2013-12-01   credit_card       :206182   1st Qu.:  11.91  
##  Median :2014-11-01   home_improvement  : 51829   Median :  17.65  
##  Mean   :2014-07-10   other             : 42894   Mean   :  18.16  
##  3rd Qu.:2015-07-01   major_purchase    : 17277   3rd Qu.:  23.95  
##  Max.   :2015-12-01   small_business    : 10377   Max.   :9999.00  
##                       (Other)           : 34605                    
##  earliest_cr_line       revol_bal       initial_list_status
##  Min.   :1944-01-01   Min.   :      0   f:456848           
##  1st Qu.:1994-06-01   1st Qu.:   6443   w:430531           
##  Median :1999-09-01   Median :  11875                      
##  Mean   :1998-03-06   Mean   :  16921                      
##  3rd Qu.:2003-05-01   3rd Qu.:  20829                      
##  Max.   :2012-11-01   Max.   :2904836                      
##  NA's   :29                                                
##    recoveries       collection_recovery_fee   application_type 
##  Min.   :    0.00   Min.   :   0.000        INDIVIDUAL:886868  
##  1st Qu.:    0.00   1st Qu.:   0.000        JOINT     :   511  
##  Median :    0.00   Median :   0.000                           
##  Mean   :   45.92   Mean   :   4.881                           
##  3rd Qu.:    0.00   3rd Qu.:   0.000                           
##  Max.   :33520.27   Max.   :7002.190                           
##                                                                
##    verification_status_joint   issue_year            Region      
##                 :886868      2015   :421094   MID_WEST  :155029  
##  Not Verified   :   283      2014   :235628   NORTH_EAST:204399  
##  Source Verified:    61      2013   :134755   SOUTH_EAST:214646  
##  Verified       :   167      2012   : 53367   SOUTH_WEST:104574  
##                              2011   : 21721   WEST      :208731  
##                              2010   : 12537                      
##                              (Other):  8277                      
##  Employment_Length earliest_cr_line_year
##  Min.   : 0.000    2001   : 63116       
##  1st Qu.: 2.000    2000   : 62614       
##  Median : 6.000    2002   : 57410       
##  Mean   : 5.745    1999   : 56747       
##  3rd Qu.:10.000    2003   : 52730       
##  Max.   :10.000    (Other):594733       
##                    NA's   :    29
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model.df =}\StringTok{ }\KeywordTok{within}\NormalTok{(loan_df, }\KeywordTok{rm}\NormalTok{(}\StringTok{"issue_d"}\NormalTok{, }\StringTok{"earliest_cr_line"}\NormalTok{))}
\NormalTok{pred.model =}\StringTok{ }\KeywordTok{lm}\NormalTok{(int_rate }\OperatorTok{~}\NormalTok{. , model.df)}
\KeywordTok{summary}\NormalTok{(pred.model)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = int_rate ~ ., data = model.df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -66.053  -1.878  -0.251   1.678  90.131 
## 
## Coefficients: (1 not defined because of singularities)
##                                            Estimate Std. Error  t value
## (Intercept)                               5.865e+00  2.451e+00    2.393
## mths_since_last_major_derog               4.519e-03  2.950e-04   15.319
## mths_since_last_delinq                    1.606e-03  2.307e-04    6.962
## tot_coll_amt                              1.049e-06  2.878e-07    3.646
## tot_cur_bal                              -1.274e-06  2.615e-08  -48.736
## total_rev_hi_lim                         -1.099e-05  1.534e-07  -71.599
## revol_util                                3.154e-02  1.470e-04  214.581
## collections_12_mths_ex_med                4.508e-01  2.139e-02   21.076
## delinq_2yrs                               2.795e-01  3.895e-03   71.755
## inq_last_6mths                            6.655e-01  3.006e-03  221.388
## open_acc                                  4.089e-02  7.898e-04   51.779
## pub_rec                                   3.586e-01  5.076e-03   70.642
## total_acc                                -1.586e-02  3.688e-04  -43.001
## acc_now_delinq                            1.077e+00  3.718e-02   28.957
## annual_inc                               -3.102e-06  5.086e-08  -60.993
## loan_amnt                                -1.209e-03  2.136e-06 -566.007
## term 60 months                            1.030e+01  1.276e-02  807.416
## installment                               3.959e-02  6.714e-05  589.644
## home_ownershipMORTGAGE                   -5.572e-01  1.548e+00   -0.360
## home_ownershipNONE                        1.327e+00  1.598e+00    0.830
## home_ownershipOTHER                       2.893e-01  1.561e+00    0.185
## home_ownershipOWN                        -1.752e-01  1.548e+00   -0.113
## home_ownershipRENT                       -2.149e-01  1.548e+00   -0.139
## verification_statusSource Verified        2.583e-01  7.309e-03   35.340
## verification_statusVerified               9.548e-01  7.714e-03  123.766
## purposecredit_card                       -6.704e-01  2.936e-02  -22.836
## purposedebt_consolidation                 3.520e-01  2.895e-02   12.161
## purposeeducational                        9.373e-01  1.354e-01    6.925
## purposehome_improvement                   6.141e-01  3.101e-02   19.803
## purposehouse                              2.245e+00  5.255e-02   42.714
## purposemajor_purchase                     5.381e-01  3.507e-02   15.345
## purposemedical                            2.163e+00  4.072e-02   53.123
## purposemoving                             3.098e+00  4.635e-02   66.835
## purposeother                              2.170e+00  3.136e-02   69.189
## purposerenewable_energy                   2.581e+00  1.154e-01   22.360
## purposesmall_business                     2.351e+00  3.894e-02   60.367
## purposevacation                           2.556e+00  4.834e-02   52.867
## purposewedding                            1.586e+00  6.247e-02   25.388
## dti                                       6.804e-03  1.714e-04   39.692
## revol_bal                                 9.594e-06  2.504e-07   38.310
## initial_list_statusw                     -6.298e-01  6.299e-03  -99.991
## recoveries                                2.897e-04  1.177e-05   24.614
## collection_recovery_fee                  -5.017e-04  7.583e-05   -6.617
## application_typeJOINT                     1.061e+00  2.077e-01    5.108
## verification_status_jointNot Verified    -1.141e+00  2.620e-01   -4.356
## verification_status_jointSource Verified  5.141e-01  4.013e-01    1.281
## verification_status_jointVerified                NA         NA       NA
## issue_year2008                            9.740e-01  1.249e-01    7.799
## issue_year2009                            8.651e-01  1.183e-01    7.316
## issue_year2010                           -3.598e-01  1.151e-01   -3.127
## issue_year2011                           -3.786e-01  1.142e-01   -3.316
## issue_year2012                            1.086e+00  1.133e-01    9.585
## issue_year2013                            1.798e+00  1.131e-01   15.907
## issue_year2014                            1.395e+00  1.130e-01   12.346
## issue_year2015                            6.901e-01  1.130e-01    6.107
## RegionNORTH_EAST                          1.956e-02  9.165e-03    2.134
## RegionSOUTH_EAST                          1.768e-01  8.973e-03   19.700
## RegionSOUTH_WEST                          1.254e-01  1.078e-02   11.628
## RegionWEST                                7.264e-02  9.187e-03    7.906
## Employment_Length                         3.531e-03  7.933e-04    4.450
## earliest_cr_line_year1946                 1.752e+00  2.682e+00    0.653
## earliest_cr_line_year1948                 1.810e+00  3.285e+00    0.551
## earliest_cr_line_year1949                 1.112e-01  3.285e+00    0.034
## earliest_cr_line_year1950                 1.617e+00  2.120e+00    0.763
## earliest_cr_line_year1951                 3.459e+00  2.190e+00    1.580
## earliest_cr_line_year1952                 1.902e+00  2.448e+00    0.777
## earliest_cr_line_year1953                -8.192e-01  2.244e+00   -0.365
## earliest_cr_line_year1954                 3.259e+00  2.244e+00    1.453
## earliest_cr_line_year1955                 1.716e+00  2.027e+00    0.847
## earliest_cr_line_year1956                 1.496e+00  2.011e+00    0.744
## earliest_cr_line_year1957                 2.963e+00  2.019e+00    1.468
## earliest_cr_line_year1958                 1.417e+00  1.963e+00    0.722
## earliest_cr_line_year1959                 6.562e-01  1.935e+00    0.339
## earliest_cr_line_year1960                 8.426e-01  1.924e+00    0.438
## earliest_cr_line_year1961                 7.154e-01  1.928e+00    0.371
## earliest_cr_line_year1962                 6.669e-01  1.918e+00    0.348
## earliest_cr_line_year1963                 7.624e-01  1.909e+00    0.399
## earliest_cr_line_year1964                 1.018e+00  1.906e+00    0.534
## earliest_cr_line_year1965                 1.167e+00  1.903e+00    0.613
## earliest_cr_line_year1966                 1.054e+00  1.902e+00    0.554
## earliest_cr_line_year1967                 9.169e-01  1.900e+00    0.482
## earliest_cr_line_year1968                 1.041e+00  1.900e+00    0.548
## earliest_cr_line_year1969                 7.325e-01  1.899e+00    0.386
## earliest_cr_line_year1970                 9.588e-01  1.899e+00    0.505
## earliest_cr_line_year1971                 7.509e-01  1.899e+00    0.395
## earliest_cr_line_year1972                 7.667e-01  1.898e+00    0.404
## earliest_cr_line_year1973                 7.855e-01  1.898e+00    0.414
## earliest_cr_line_year1974                 8.946e-01  1.898e+00    0.471
## earliest_cr_line_year1975                 9.762e-01  1.897e+00    0.514
## earliest_cr_line_year1976                 9.959e-01  1.897e+00    0.525
## earliest_cr_line_year1977                 9.506e-01  1.897e+00    0.501
## earliest_cr_line_year1978                 8.972e-01  1.897e+00    0.473
## earliest_cr_line_year1979                 9.790e-01  1.897e+00    0.516
## earliest_cr_line_year1980                 9.614e-01  1.897e+00    0.507
## earliest_cr_line_year1981                 9.902e-01  1.897e+00    0.522
## earliest_cr_line_year1982                 9.255e-01  1.897e+00    0.488
## earliest_cr_line_year1983                 9.571e-01  1.897e+00    0.505
## earliest_cr_line_year1984                 1.068e+00  1.897e+00    0.563
## earliest_cr_line_year1985                 1.046e+00  1.897e+00    0.552
## earliest_cr_line_year1986                 1.079e+00  1.897e+00    0.569
## earliest_cr_line_year1987                 1.108e+00  1.896e+00    0.584
## earliest_cr_line_year1988                 1.111e+00  1.896e+00    0.586
## earliest_cr_line_year1989                 1.115e+00  1.896e+00    0.588
## earliest_cr_line_year1990                 1.117e+00  1.896e+00    0.589
## earliest_cr_line_year1991                 1.150e+00  1.896e+00    0.606
## earliest_cr_line_year1992                 1.162e+00  1.896e+00    0.613
## earliest_cr_line_year1993                 1.196e+00  1.896e+00    0.630
## earliest_cr_line_year1994                 1.233e+00  1.896e+00    0.650
## earliest_cr_line_year1995                 1.254e+00  1.896e+00    0.661
## earliest_cr_line_year1996                 1.288e+00  1.896e+00    0.679
## earliest_cr_line_year1997                 1.293e+00  1.896e+00    0.682
## earliest_cr_line_year1998                 1.297e+00  1.896e+00    0.684
## earliest_cr_line_year1999                 1.323e+00  1.896e+00    0.698
## earliest_cr_line_year2000                 1.350e+00  1.896e+00    0.712
## earliest_cr_line_year2001                 1.407e+00  1.896e+00    0.742
## earliest_cr_line_year2002                 1.485e+00  1.896e+00    0.783
## earliest_cr_line_year2003                 1.558e+00  1.896e+00    0.822
## earliest_cr_line_year2004                 1.705e+00  1.896e+00    0.899
## earliest_cr_line_year2005                 1.806e+00  1.896e+00    0.953
## earliest_cr_line_year2006                 1.914e+00  1.896e+00    1.009
## earliest_cr_line_year2007                 2.160e+00  1.896e+00    1.139
## earliest_cr_line_year2008                 2.472e+00  1.896e+00    1.304
## earliest_cr_line_year2009                 2.712e+00  1.897e+00    1.430
## earliest_cr_line_year2010                 2.960e+00  1.897e+00    1.560
## earliest_cr_line_year2011                 3.218e+00  1.897e+00    1.697
## earliest_cr_line_year2012                 3.489e+00  1.897e+00    1.839
##                                          Pr(>|t|)    
## (Intercept)                              0.016720 *  
## mths_since_last_major_derog               < 2e-16 ***
## mths_since_last_delinq                   3.35e-12 ***
## tot_coll_amt                             0.000267 ***
## tot_cur_bal                               < 2e-16 ***
## total_rev_hi_lim                          < 2e-16 ***
## revol_util                                < 2e-16 ***
## collections_12_mths_ex_med                < 2e-16 ***
## delinq_2yrs                               < 2e-16 ***
## inq_last_6mths                            < 2e-16 ***
## open_acc                                  < 2e-16 ***
## pub_rec                                   < 2e-16 ***
## total_acc                                 < 2e-16 ***
## acc_now_delinq                            < 2e-16 ***
## annual_inc                                < 2e-16 ***
## loan_amnt                                 < 2e-16 ***
## term 60 months                            < 2e-16 ***
## installment                               < 2e-16 ***
## home_ownershipMORTGAGE                   0.718990    
## home_ownershipNONE                       0.406522    
## home_ownershipOTHER                      0.852999    
## home_ownershipOWN                        0.909904    
## home_ownershipRENT                       0.889600    
## verification_statusSource Verified        < 2e-16 ***
## verification_statusVerified               < 2e-16 ***
## purposecredit_card                        < 2e-16 ***
## purposedebt_consolidation                 < 2e-16 ***
## purposeeducational                       4.37e-12 ***
## purposehome_improvement                   < 2e-16 ***
## purposehouse                              < 2e-16 ***
## purposemajor_purchase                     < 2e-16 ***
## purposemedical                            < 2e-16 ***
## purposemoving                             < 2e-16 ***
## purposeother                              < 2e-16 ***
## purposerenewable_energy                   < 2e-16 ***
## purposesmall_business                     < 2e-16 ***
## purposevacation                           < 2e-16 ***
## purposewedding                            < 2e-16 ***
## dti                                       < 2e-16 ***
## revol_bal                                 < 2e-16 ***
## initial_list_statusw                      < 2e-16 ***
## recoveries                                < 2e-16 ***
## collection_recovery_fee                  3.67e-11 ***
## application_typeJOINT                    3.26e-07 ***
## verification_status_jointNot Verified    1.32e-05 ***
## verification_status_jointSource Verified 0.200127    
## verification_status_jointVerified              NA    
## issue_year2008                           6.25e-15 ***
## issue_year2009                           2.55e-13 ***
## issue_year2010                           0.001764 ** 
## issue_year2011                           0.000913 ***
## issue_year2012                            < 2e-16 ***
## issue_year2013                            < 2e-16 ***
## issue_year2014                            < 2e-16 ***
## issue_year2015                           1.01e-09 ***
## RegionNORTH_EAST                         0.032859 *  
## RegionSOUTH_EAST                          < 2e-16 ***
## RegionSOUTH_WEST                          < 2e-16 ***
## RegionWEST                               2.65e-15 ***
## Employment_Length                        8.58e-06 ***
## earliest_cr_line_year1946                0.513666    
## earliest_cr_line_year1948                0.581528    
## earliest_cr_line_year1949                0.972989    
## earliest_cr_line_year1950                0.445604    
## earliest_cr_line_year1951                0.114213    
## earliest_cr_line_year1952                0.437224    
## earliest_cr_line_year1953                0.715052    
## earliest_cr_line_year1954                0.146351    
## earliest_cr_line_year1955                0.397209    
## earliest_cr_line_year1956                0.457171    
## earliest_cr_line_year1957                0.142193    
## earliest_cr_line_year1958                0.470342    
## earliest_cr_line_year1959                0.734596    
## earliest_cr_line_year1960                0.661510    
## earliest_cr_line_year1961                0.710553    
## earliest_cr_line_year1962                0.728005    
## earliest_cr_line_year1963                0.689576    
## earliest_cr_line_year1964                0.593131    
## earliest_cr_line_year1965                0.539892    
## earliest_cr_line_year1966                0.579586    
## earliest_cr_line_year1967                0.629454    
## earliest_cr_line_year1968                0.583965    
## earliest_cr_line_year1969                0.699730    
## earliest_cr_line_year1970                0.613611    
## earliest_cr_line_year1971                0.692478    
## earliest_cr_line_year1972                0.686242    
## earliest_cr_line_year1973                0.678954    
## earliest_cr_line_year1974                0.637333    
## earliest_cr_line_year1975                0.606928    
## earliest_cr_line_year1976                0.599617    
## earliest_cr_line_year1977                0.616281    
## earliest_cr_line_year1978                0.636214    
## earliest_cr_line_year1979                0.605792    
## earliest_cr_line_year1980                0.612276    
## earliest_cr_line_year1981                0.601646    
## earliest_cr_line_year1982                0.625571    
## earliest_cr_line_year1983                0.613830    
## earliest_cr_line_year1984                0.573239    
## earliest_cr_line_year1985                0.581093    
## earliest_cr_line_year1986                0.569552    
## earliest_cr_line_year1987                0.559214    
## earliest_cr_line_year1988                0.557943    
## earliest_cr_line_year1989                0.556610    
## earliest_cr_line_year1990                0.555729    
## earliest_cr_line_year1991                0.544400    
## earliest_cr_line_year1992                0.539931    
## earliest_cr_line_year1993                0.528394    
## earliest_cr_line_year1994                0.515737    
## earliest_cr_line_year1995                0.508569    
## earliest_cr_line_year1996                0.496975    
## earliest_cr_line_year1997                0.495443    
## earliest_cr_line_year1998                0.493888    
## earliest_cr_line_year1999                0.485453    
## earliest_cr_line_year2000                0.476390    
## earliest_cr_line_year2001                0.458120    
## earliest_cr_line_year2002                0.433595    
## earliest_cr_line_year2003                0.411295    
## earliest_cr_line_year2004                0.368658    
## earliest_cr_line_year2005                0.340813    
## earliest_cr_line_year2006                0.312833    
## earliest_cr_line_year2007                0.254796    
## earliest_cr_line_year2008                0.192329    
## earliest_cr_line_year2009                0.152760    
## earliest_cr_line_year2010                0.118654    
## earliest_cr_line_year2011                0.089770 .  
## earliest_cr_line_year2012                0.065905 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.682 on 887225 degrees of freedom
##   (29 observations deleted due to missingness)
## Multiple R-squared:  0.6255, Adjusted R-squared:  0.6254 
## F-statistic: 1.195e+04 on 124 and 887225 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{## earliest_cr_line_year/ home_ownership/ mths_since_last_delinq is not promising. ##delete this feature}
\NormalTok{model.df=}\KeywordTok{within}\NormalTok{(model.df, }\KeywordTok{rm}\NormalTok{(}\StringTok{"earliest_cr_line_year"}\NormalTok{, }\StringTok{"home_ownership"}\NormalTok{, }\StringTok{"mths_since_last_delinq"}\NormalTok{))}
\NormalTok{pred.model =}\StringTok{ }\KeywordTok{lm}\NormalTok{(int_rate }\OperatorTok{~}\NormalTok{. , model.df)}
\KeywordTok{summary}\NormalTok{(pred.model)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = int_rate ~ ., data = model.df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -66.710  -1.911  -0.253   1.694 100.937 
## 
## Coefficients: (1 not defined because of singularities)
##                                            Estimate Std. Error  t value
## (Intercept)                               7.234e+00  1.158e-01   62.491
## mths_since_last_major_derog               3.855e-03  2.762e-04   13.955
## tot_coll_amt                              8.503e-07  2.909e-07    2.923
## tot_cur_bal                              -1.891e-06  2.382e-08  -79.393
## total_rev_hi_lim                         -1.188e-05  1.547e-07  -76.755
## revol_util                                3.061e-02  1.482e-04  206.554
## collections_12_mths_ex_med                4.123e-01  2.160e-02   19.083
## delinq_2yrs                               2.344e-01  3.614e-03   64.855
## inq_last_6mths                            6.741e-01  3.036e-03  222.056
## open_acc                                  5.575e-02  7.869e-04   70.851
## pub_rec                                   2.831e-01  5.091e-03   55.607
## total_acc                                -3.040e-02  3.534e-04  -86.013
## acc_now_delinq                            1.000e+00  3.747e-02   26.691
## annual_inc                               -3.071e-06  5.125e-08  -59.917
## loan_amnt                                -1.238e-03  2.146e-06 -576.728
## term 60 months                            1.041e+01  1.285e-02  810.188
## installment                               4.035e-02  6.757e-05  597.217
## verification_statusSource Verified        2.881e-01  7.381e-03   39.031
## verification_statusVerified               9.502e-01  7.785e-03  122.066
## purposecredit_card                       -6.970e-01  2.967e-02  -23.492
## purposedebt_consolidation                 3.177e-01  2.925e-02   10.861
## purposeeducational                        9.549e-01  1.368e-01    6.981
## purposehome_improvement                   4.874e-01  3.130e-02   15.574
## purposehouse                              2.287e+00  5.311e-02   43.071
## purposemajor_purchase                     5.516e-01  3.544e-02   15.561
## purposemedical                            2.093e+00  4.115e-02   50.857
## purposemoving                             3.179e+00  4.681e-02   67.902
## purposeother                              2.159e+00  3.169e-02   68.120
## purposerenewable_energy                   2.588e+00  1.167e-01   22.183
## purposesmall_business                     2.333e+00  3.936e-02   59.267
## purposevacation                           2.574e+00  4.886e-02   52.681
## purposewedding                            1.619e+00  6.313e-02   25.653
## dti                                       6.809e-03  1.732e-04   39.303
## revol_bal                                 9.505e-06  2.527e-07   37.615
## initial_list_statusw                     -6.409e-01  6.365e-03 -100.691
## recoveries                                3.017e-04  1.190e-05   25.360
## collection_recovery_fee                  -5.340e-04  7.660e-05   -6.972
## application_typeJOINT                     1.022e+00  2.099e-01    4.871
## verification_status_jointNot Verified    -1.111e+00  2.648e-01   -4.196
## verification_status_jointSource Verified  5.825e-01  4.056e-01    1.436
## verification_status_jointVerified                NA         NA       NA
## issue_year2008                            1.035e+00  1.236e-01    8.371
## issue_year2009                            9.393e-01  1.167e-01    8.047
## issue_year2010                           -2.544e-01  1.134e-01   -2.242
## issue_year2011                           -2.411e-01  1.125e-01   -2.143
## issue_year2012                            1.288e+00  1.116e-01   11.540
## issue_year2013                            2.043e+00  1.114e-01   18.349
## issue_year2014                            1.699e+00  1.113e-01   15.273
## issue_year2015                            1.070e+00  1.113e-01    9.615
## RegionNORTH_EAST                          9.736e-02  9.182e-03   10.603
## RegionSOUTH_EAST                          2.023e-01  9.065e-03   22.315
## RegionSOUTH_WEST                          1.486e-01  1.089e-02   13.638
## RegionWEST                                1.572e-01  9.153e-03   17.176
## Employment_Length                        -1.662e-02  7.830e-04  -21.229
##                                          Pr(>|t|)    
## (Intercept)                               < 2e-16 ***
## mths_since_last_major_derog               < 2e-16 ***
## tot_coll_amt                              0.00347 ** 
## tot_cur_bal                               < 2e-16 ***
## total_rev_hi_lim                          < 2e-16 ***
## revol_util                                < 2e-16 ***
## collections_12_mths_ex_med                < 2e-16 ***
## delinq_2yrs                               < 2e-16 ***
## inq_last_6mths                            < 2e-16 ***
## open_acc                                  < 2e-16 ***
## pub_rec                                   < 2e-16 ***
## total_acc                                 < 2e-16 ***
## acc_now_delinq                            < 2e-16 ***
## annual_inc                                < 2e-16 ***
## loan_amnt                                 < 2e-16 ***
## term 60 months                            < 2e-16 ***
## installment                               < 2e-16 ***
## verification_statusSource Verified        < 2e-16 ***
## verification_statusVerified               < 2e-16 ***
## purposecredit_card                        < 2e-16 ***
## purposedebt_consolidation                 < 2e-16 ***
## purposeeducational                       2.93e-12 ***
## purposehome_improvement                   < 2e-16 ***
## purposehouse                              < 2e-16 ***
## purposemajor_purchase                     < 2e-16 ***
## purposemedical                            < 2e-16 ***
## purposemoving                             < 2e-16 ***
## purposeother                              < 2e-16 ***
## purposerenewable_energy                   < 2e-16 ***
## purposesmall_business                     < 2e-16 ***
## purposevacation                           < 2e-16 ***
## purposewedding                            < 2e-16 ***
## dti                                       < 2e-16 ***
## revol_bal                                 < 2e-16 ***
## initial_list_statusw                      < 2e-16 ***
## recoveries                                < 2e-16 ***
## collection_recovery_fee                  3.14e-12 ***
## application_typeJOINT                    1.11e-06 ***
## verification_status_jointNot Verified    2.72e-05 ***
## verification_status_jointSource Verified  0.15090    
## verification_status_jointVerified              NA    
## issue_year2008                            < 2e-16 ***
## issue_year2009                           8.49e-16 ***
## issue_year2010                            0.02495 *  
## issue_year2011                            0.03213 *  
## issue_year2012                            < 2e-16 ***
## issue_year2013                            < 2e-16 ***
## issue_year2014                            < 2e-16 ***
## issue_year2015                            < 2e-16 ***
## RegionNORTH_EAST                          < 2e-16 ***
## RegionSOUTH_EAST                          < 2e-16 ***
## RegionSOUTH_WEST                          < 2e-16 ***
## RegionWEST                                < 2e-16 ***
## Employment_Length                         < 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.711 on 887326 degrees of freedom
## Multiple R-squared:  0.6173, Adjusted R-squared:  0.6173 
## F-statistic: 2.753e+04 on 52 and 887326 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# in output}
\CommentTok{# Multiple R-squared:  0.6176,  Adjusted R-squared:  0.6175 }
\CommentTok{# if R-square <= 0.3 it's pretty poor}
\CommentTok{# F-statistic: 2.703e+04 on 53 and 887325 DF,  p-value: < 2.2e-16}
\CommentTok{# F test => if the variance interpreted by the model vs. not interpreted by the model is significant. }
\CommentTok{# more siginificant is better. }
\end{Highlighting}
\end{Shaded}


\end{document}
